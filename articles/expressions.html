<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Expressions • quartzbio.edp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Expressions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">quartzbio.edp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/r_authentication.html">Authentication</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/quartzbio/quartzbio.edp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Expressions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quartzbio/quartzbio.edp/blob/main/vignettes/expressions.Rmd" class="external-link"><code>vignettes/expressions.Rmd</code></a></small>
      <div class="d-none name"><code>expressions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Expressions on the QuartzBio Enterprise Data Platform (EDP) are
Python-like formulas that can be used to pull data from datasets,
calculate statistics, or run advanced algorithms. They are typically
used when transforming datasets but have many other uses such as
building web application widgets, pulling EDP data into Excel or Google
Sheets, and augmenting databases outside EDP. Expressions are also
referred to as Python “one-liners” but can be used in both the Python
and R client libraries for EDP. Expressions may also be evaluated in the
EDP UI for data discovery and data transformation.</p>
</div>
<div class="section level2">
<h2 id="expression-syntax">Expression Syntax<a class="anchor" aria-label="anchor" href="#expression-syntax"></a>
</h2>
<p>Expressions resemble a single line of code in the Python language.
Expressions can only be one valid line of code but can contain line
breaks for presentation purposes. As a result, they do not support the
declaration of variables or classes.</p>
<p>Expressions can use the built-in library of expression functions in
EDP. The expression functions library is maintained by QuartzBio staff
and users are encouraged to submit suggestions for new functions to be
added to the library.</p>
<p>Expressions can be a simple static value, such as a number or
string:</p>
<pre><code><span><span class="co"># Numeric expression</span></span>
<span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># output: 7</span></span>
<span></span>
<span><span class="co"># String expression</span></span>
<span><span class="st">"hello"</span> <span class="op">+</span> <span class="st">" world"</span></span>
<span><span class="co"># output: "hello world"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="context-variables">Context Variables<a class="anchor" aria-label="anchor" href="#context-variables"></a>
</h2>
<p>Depending on when an expression is evaluated, it may also include
“context variables”. These are variables available to the expression
interpreter at run-time (similar to the library of available
functions).</p>
<p>For example, expressions can reference context values provided during
evaluation or annotation, such as record:</p>
<pre><code><span><span class="co"># String expression with context: {"record": {"a": "hello"}}</span></span>
<span><span class="va">record</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span> <span class="op">+</span> <span class="st">" world"</span></span>
<span><span class="co"># output: "hello world"</span></span></code></pre>
<p>The following context variables may be referenced:</p>
<ul>
<li><p>record: An object containing the current dataset record (or
“row”) currently being processed. Users can access field values in the
record using Python dictionary notation (e.g. record[‘field’]) or by dot
notation (e.g. record.field).</p></li>
<li><p>value: The value of the current field before being processed.
This can be used as a shortcut for retrieving the current
value.</p></li>
<li><p>source_filename: The filename of the file being imported. This is
only available for expressions for fields passed into a dataset import
with a manifest or object_id. This is useful if metadata is encoded
within the filename e.g. sample info or genome build. This value will be
None for dataset imports with records (i.e. when no file is
provided)..</p></li>
<li><p>source_dataset: the ID of the source dataset. This is the same as
the source_id in a dataset migration. This value is always None for
dataset imports (since the source is a file or a list of JSON records,
not a dataset).</p></li>
<li><p>target_dataset: the ID of the target dataset. This is the same as
the target_id in a dataset migration and the dataset_id in a dataset
import.</p></li>
</ul>
<p>The following example shows how these variables can be used during
annotation (i.e. when importing or migrating datasets), along with a
built-in expression function such as “split”:</p>
<p>If the current record is: <code>{"message": "hello"}</code></p>
<p>The following fields have valid expressions:</p>
<pre><code>{
    # Replace the value of `message` with "hello world"
    "message": {
        "expression": 'value + "world"',
        "ordering": 0
    }


# Create a new field containing ["hello", "world"] using the split function
    "split_message": {
        "expression": 'record.message.split()',
        "ordering": 1
        "is_list": True
    }
}</code></pre>
<p>The output would be:</p>
<p><code>{"message": "hello world", "split_message": ["hello", "world"]}</code></p>
<p>As well as split, users can also use several other built-in Python
functions such as len, min, max, sum, round, range, and a wide range of
EDP-specific functions to perform analysis on datasets.In addition,
users can wrap functions in other functions, and iterate through lists.
This makes it possible to construct advanced expressions that pull and
manipulate data from one or more datasets:</p>
<pre><code># Numeric expression using built-in functions
sum(i for i in range(100))
# output: 4950

# Numeric expression using a built-in EDP function
dataset_field_stats("quartzbio:Public:/ClinVar/5.2.0-20210110/Variants-GRCH37", "info.ORIGIN")["avg"]
# output: 0.883874789018</code></pre>
</div>
<div class="section level2">
<h2 id="data-types-and-lists">Data Types and Lists<a class="anchor" aria-label="anchor" href="#data-types-and-lists"></a>
</h2>
<p>Expressions always have a return value. The value’s data type depends
on the expression, but can be one of the following:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Data Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>string (default)</td>
<td>A valid UTF-8 string with up to 32,766 characters.</td>
</tr>
<tr class="even">
<td>text</td>
<td>A valid UTF-8 string of any length.</td>
</tr>
<tr class="odd">
<td>blob</td>
<td>A valid UTF-8 string of any length (this data type is not indexed
for search).</td>
</tr>
<tr class="even">
<td>date</td>
<td>A string in ISO 8601 format, for example:
“2017-03-29T14:52:01”.</td>
</tr>
<tr class="odd">
<td>integer</td>
<td>A signed 32-bit integer with a minimum value of -231 and a maximum
value of 231-1.</td>
</tr>
<tr class="even">
<td>long</td>
<td>A signed 64-bit integer with a minimum value of -263 and a maximum
value of 263-1.</td>
</tr>
<tr class="odd">
<td>float</td>
<td>single-precision 32-bit IEEE 754 floating point.</td>
</tr>
<tr class="even">
<td>double</td>
<td>A double-precision 64-bit IEEE 754 floating point.</td>
</tr>
<tr class="odd">
<td>boolean</td>
<td>Casts the result to a boolean: True or False. Uses Python’s truth
value testing rules.</td>
</tr>
<tr class="even">
<td>object</td>
<td>A key/value, JSON-like object, similar to a Python dictionary.</td>
</tr>
</tbody>
</table>
<p>Expressions can be set up to return a single value (default) or a
list of values. Enabling list mode will cause the expression to always
cast the return value as a list, and vice-versa.</p>
</div>
<div class="section level2">
<h2 id="type-casting">Type Casting<a class="anchor" aria-label="anchor" href="#type-casting"></a>
</h2>
<p>Each data type “casts” the result of an expression ensuring
compatibility with the underlying dataset system. If the result of an
expression is incompatible with the data type, an error will be raised
for that record.</p>
<p>For return values compatible with the required data type, the final
result should be straightforward. It is important to note that
expressions make a distinction between null values (i.e. Python None),
empty strings, and empty lists. The following tables show what to expect
when encountering these types of values for different data types:</p>
<table class="table">
<thead><tr class="header">
<th align="center">Expression Result</th>
<th align="center">Data Type</th>
<th align="center">As Value</th>
<th align="center">As List</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">“”</td>
<td align="center">string/text</td>
<td align="center">“”</td>
<td align="center">[“”]</td>
</tr>
<tr class="even">
<td align="center">[“”]</td>
<td align="center">string/text</td>
<td align="center">“”</td>
<td align="center">[“”]</td>
</tr>
<tr class="odd">
<td align="center">None</td>
<td align="center">string/text</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="even">
<td align="center">[None]</td>
<td align="center">string/text</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="odd">
<td align="center">[]</td>
<td align="center">string/text</td>
<td align="center">None</td>
<td align="center">[]</td>
</tr>
<tr class="even">
<td align="center">“”</td>
<td align="center">integer/float</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="odd">
<td align="center">[“”]</td>
<td align="center">integer/float</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="even">
<td align="center">None</td>
<td align="center">integer/float</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="odd">
<td align="center">[None]</td>
<td align="center">integer/float</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="even">
<td align="center">[]</td>
<td align="center">integer/float</td>
<td align="center">None</td>
<td align="center">[]</td>
</tr>
<tr class="odd">
<td align="center">“”</td>
<td align="center">boolean</td>
<td align="center">False</td>
<td align="center">[False]</td>
</tr>
<tr class="even">
<td align="center">[“”]</td>
<td align="center">boolean</td>
<td align="center">False</td>
<td align="center">[False]</td>
</tr>
<tr class="odd">
<td align="center">None</td>
<td align="center">boolean</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="even">
<td align="center">[None]</td>
<td align="center">boolean</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
<tr class="odd">
<td align="center">[]</td>
<td align="center">boolean</td>
<td align="center">None</td>
<td align="center">[]</td>
</tr>
<tr class="even">
<td align="center">float(“inf”)</td>
<td align="center">float</td>
<td align="center">Infinity</td>
<td align="center">[Infinity]</td>
</tr>
<tr class="odd">
<td align="center">float(“-inf”)</td>
<td align="center">float</td>
<td align="center">-Infinity</td>
<td align="center">[-Infinity]</td>
</tr>
<tr class="even">
<td align="center">float(“NaN”)</td>
<td align="center">float</td>
<td align="center">None</td>
<td align="center">[None]</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="using-expressions">Using Expressions<a class="anchor" aria-label="anchor" href="#using-expressions"></a>
</h2>
<p>Most commonly, expressions are used to <a href="transforming_datasets.html">transform datasets</a>.</p>
<p>Dataset imports and migrations are asynchronous tasks that can take
time to run. There are two ways to run expressions in real time:</p>
<ul>
<li>Evaluation: run a single expression with custom context values.</li>
<li>Annotation: run one or more expressions on an arbitrary list of
records.</li>
</ul>
</div>
<div class="section level2">
<h2 id="evaluate-an-expression">Evaluate an Expression<a class="anchor" aria-label="anchor" href="#evaluate-an-expression"></a>
</h2>
<p>The ability to evaluate a single expression is helpful when testing
new expressions, or in the context of an application view that needs a
very specific piece of information. When evaluating individual
expressions using the evaluate endpoint, no context is included by
default. Users can provide a custom dictionary of context variables
through the data parameter.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://quartzbio.github.io/quartzbio.edp/">quartzbio.edp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Static expression</span></span>
<span><span class="fu"><a href="../reference/Expression.evaluate.html">Expression.evaluate</a></span><span class="op">(</span><span class="st">'"hello" + " " + "world"'</span><span class="op">)</span></span>
<span><span class="co"># Response: 'hello world'</span></span>
<span></span>
<span><span class="co"># Expression with a context variable "my_field"</span></span>
<span><span class="fu"><a href="../reference/Expression.evaluate.html">Expression.evaluate</a></span><span class="op">(</span></span>
<span>  <span class="st">'"hello" + " " + my_field'</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>my_field <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Response: 'hello world'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="annotating-records">Annotating Records<a class="anchor" aria-label="anchor" href="#annotating-records"></a>
</h2>
<p>Users can annotate a list of records in real time (i.e. without
saving them to a dataset) using the annotate endpoint. This provides a
way to quickly test one or more expressions on a list of records. To
annotate an entire dataset, see <a href="transforming_datasets.html">Transforming Datasets</a>.</p>
<div class="section level3">
<h3 id="examples">Examples:<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://quartzbio.github.io/quartzbio.edp/">quartzbio.edp</a></span><span class="op">)</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="st">"BRCA1"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="st">"BRCA2"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="st">"BRAF"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="st">"TTN"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="st">"TP53"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Define the fields to annotate</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># How many times is the gene in ClinVar?</span></span>
<span>    name <span class="op">=</span> <span class="st">"clinvar_count"</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"integer"</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"dataset_count(</span></span>
<span><span class="st">    'quartzbio:Public:/ClinVar/5.2.0-20210110/Variants-GRCH38',</span></span>
<span><span class="st">    entities=[('gene', record.gene)]</span></span>
<span><span class="st">    )"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># What chromosome is the gene on?</span></span>
<span>    name <span class="op">=</span> <span class="st">"chromosome"</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">    dataset_query(</span></span>
<span><span class="st">    'quartzbio:Public:/ClinVar/5.2.0-20210110/Variants-GRCH38',</span></span>
<span><span class="st">    entities=[('gene', record.gene)],</span></span>
<span><span class="st">    filters=[('feature', 'gene')]</span></span>
<span><span class="st">    )[0]['genomic_coordinates']['chromosome']"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Set the current date and time.</span></span>
<span>    name <span class="op">=</span> <span class="st">"date_evaluated"</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"now()"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Annotator.annotate.html">Annotator.annotate</a></span><span class="op">(</span>records <span class="op">=</span> <span class="va">records</span>, fields <span class="op">=</span> <span class="va">fields</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expression-functions">Expression Functions<a class="anchor" aria-label="anchor" href="#expression-functions"></a>
</h3>
<p>Users are encouraged to review the <a href="expression_functions.html">Expression Functions article</a> to
access a list of all built-in EDP expression functions along with
details about each function.</p>
</div>
</div>
<div class="section level2">
<h2 id="use-cases">Use Cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h2>
<p>Expressions can be evaluated using the EDP Python and R client
libraries, such as when querying and annotating datasets. Expressions
can also be used when creating Expression Recipes and Dataset Templates
in EDP, which are data management tools designed to facilitate dataset
transformation and annotation.</p>
</div>
<div class="section level2">
<h2 id="expression-recipes">Expression Recipes<a class="anchor" aria-label="anchor" href="#expression-recipes"></a>
</h2>
<p>Recipes are expressions that are used to add or modify a dataset
field and may be accessed from the EDP web interface to insert or modify
a column (field) in a dataset. Recipes can also be used to join datasets
by adding multiple fields to a dataset from other datasets based on join
conditions. Users are recommended to read the Recipes documentation for
an in-depth review of Recipes.</p>
</div>
<div class="section level2">
<h2 id="dataset-templates">Dataset Templates<a class="anchor" aria-label="anchor" href="#dataset-templates"></a>
</h2>
<p>Templates describe how data should be transformed. A template is a
collection of fields (columns) that describe the desired format of some
input data. Templates are used to import, export, query, or migrate
data. Expressions can be used in templates for field normalization and
transformation, as well as for adding additional fields and annotations
to input data. Users are recommended to read the <a href="dataset_templates.html">Dataset Templates</a> documentation for an
in-depth review of Templates.</p>
</div>
<div class="section level2">
<h2 id="api-endpoints">API Endpoints<a class="anchor" aria-label="anchor" href="#api-endpoints"></a>
</h2>
<p>There are two endpoints that can be used to run expressions in
real-time: annotate and evaluate. Annotate can be used to transform a
list of records, and evaluate can be used for running individual
expressions. These two endpoints are primarily designed for testing
expressions and dataset templates but they can also be used when data
outside of datasets need to be processed. To annotate entire datasets or
imported files, see <a href="transforming_datasets.html">Transforming
Data</a>. Also, see <a href="expression_functions.html">Expression
Functions</a> for a list of functions available for use in
expressions.</p>
<p>Methods do not accept URL parameters or request bodies unless
specified. Please note that if your EDP endpoint is
sponsor.edp.aws.quartz.bio, you would use
sponsor.api.edp.aws.quartz.bio.</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="17%">
<col width="17%">
<col width="17%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">annotate</td>
<td align="center">POST <a href="https://" class="external-link uri">https://</a><edp_api_host>/v1/annotate</edp_api_host>
</td>
<td align="center">Annotate a list of records with expressions.</td>
<td align="center">This request requires an authorized user.</td>
<td align="center">The response contains a list of annotated records and
an object containing the number of records with errors and the number of
fields with errors.</td>
</tr>
<tr class="even">
<td align="center">evaluate</td>
<td align="center">POST <a href="https://" class="external-link uri">https://</a><edp_api_host>/v1/evaluate</edp_api_host>
</td>
<td align="center">Run a single expression with a custom context.</td>
<td align="center">This request requires an authorized user.</td>
<td align="center">The response contains the evaluated expression.</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="annotate">Annotate<a class="anchor" aria-label="anchor" href="#annotate"></a>
</h3>
<p>Run a set of expressions on a list of records in real-time.</p>
<div class="section level4">
<h4 id="request-body">Request Body<a class="anchor" aria-label="anchor" href="#request-body"></a>
</h4>
<p>In the request body, provide the following properties:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">fields</td>
<td align="center">DatasetField</td>
<td align="center">A list of <a href="creating_and_migrating_datasets.html">dataset field
objects.</a>
</td>
</tr>
<tr class="even">
<td align="center">include_errors</td>
<td align="center">boolean</td>
<td align="center">If True, a new field (_errors) will be added to each
record containing expression evaluation errors (default: True).</td>
</tr>
<tr class="odd">
<td align="center">records</td>
<td align="center">objects</td>
<td align="center">An arbitrary list of records.</td>
</tr>
<tr class="even">
<td align="center">pre_annotation_expression</td>
<td align="center">string</td>
<td align="center">An arbitrary expression that will be applied before
the annotation, e.g. ‘explode(record, fields=[“mutations”])’</td>
</tr>
<tr class="odd">
<td align="center">post_annotation_expression</td>
<td align="center">string</td>
<td align="center">An arbitrary expression that will be applied after
the annotation, e.g. ‘melt(record,fields=[“gene”, “chromosome”])’</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="evaluate">Evaluate<a class="anchor" aria-label="anchor" href="#evaluate"></a>
</h3>
<p>Evaluate a single expression with a custom context.</p>
<div class="section level4">
<h4 id="request-body-1">Request Body<a class="anchor" aria-label="anchor" href="#request-body-1"></a>
</h4>
<p>In the request body, provide the following properties:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">fields</td>
<td align="center">object</td>
<td align="center">An object containing variables referenced in the
expression.</td>
</tr>
<tr class="even">
<td align="center">data_type</td>
<td align="center">string</td>
<td align="center">A valid data type to cast the result to.</td>
</tr>
<tr class="odd">
<td align="center">expression</td>
<td align="center">string</td>
<td align="center">A valid expression.</td>
</tr>
<tr class="even">
<td align="center">is_list</td>
<td align="center">boolean</td>
<td align="center">True if the result should be a list of values
(default: False).</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="common-issues">Common Issues<a class="anchor" aria-label="anchor" href="#common-issues"></a>
</h3>
<p>Using expressions does require some basic knowledge of Python. Due to
the condensed nature of an expression, syntax errors can be hard to
spot. Selecting the correct data type can also be confusing at
times.</p>
<p><strong>The data type defines the final output of an
expression.</strong></p>
<p>One common issue is confusing the data type of a particular function
with the final output of an expression. When working with functions,
users can look to its documentation to see what it returns. If it
returns a list, users should make sure their expression handles that,
even if list mode is disabled.</p>
<p><strong>Some data types are incompatible with some
functions.</strong></p>
<p>If a function returns a string, but the user has set the expression’s
data type to an integer, double, or object, it may not evaluate
properly.</p>
<p><strong>When list mode is disabled it will never return a
list.</strong></p>
<p>If list mode is disabled but the expression returns a list, only the
first value will be returned. Conversely, if list mode is enabled, the
value will always be cast to a list.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Caplan, Karl Forner, QuartzBio.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last modified: 18-Mar-2025 Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
