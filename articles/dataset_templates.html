<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dataset Templates • quartzbio.edp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dataset Templates">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">quartzbio.edp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/r_authentication.html">Authentication</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/quartzbio/quartzbio.edp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dataset Templates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quartzbio/quartzbio.edp/blob/main/vignettes/dataset_templates.Rmd" class="external-link"><code>vignettes/dataset_templates.Rmd</code></a></small>
      <div class="d-none name"><code>dataset_templates.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Dataset templates describe how data should be transformed. A template
is a collection of fields (columns) that describe the desired format of
some input data. Templates are used to import files, export, query or
migrate data. They allow for field normalization and transformation, and
also for the addition of fields and annotations. In this article, users
will learn how to view, create, update and apply templates for
transforming datasets.</p>
</div>
<div class="section level2">
<h2 id="retrieving-templates">Retrieving Templates<a class="anchor" aria-label="anchor" href="#retrieving-templates"></a>
</h2>
<p>To list all templates:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_templates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.all.html">DatasetTemplate.all</a></span><span class="op">(</span>template_type <span class="op">=</span> <span class="st">"dataset"</span><span class="op">)</span></span></code></pre></div>
<p>It will return all available dataset templates with their names,
template id, organization, account id and status.</p>
<p>To retrieve a template by known ID:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.retrieve.html">DatasetTemplate.retrieve</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"template_id"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="template-fields">Template Fields<a class="anchor" aria-label="anchor" href="#template-fields"></a>
</h2>
<p>The list of fields is the most important part of a template. Each
field describes a DatasetField, an object that defines properties of the
field such as name, title, and data type as key-value pairs. Fields are
written as lists in R.</p>
<p>Example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"reason"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Reason"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"The reasons for the significance value"</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>    depends_on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"reason_list"</span><span class="op">)</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"', '.join(record.reason_list) if record.reason_list else None"</span>,</span>
<span>    ordering <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="template-permissions">Template Permissions<a class="anchor" aria-label="anchor" href="#template-permissions"></a>
</h2>
<p>By default, all newly created templates are accessible by everyone at
the user’s organization.</p>
<p>If users want the template to be shown in the UI (in the modal used
for transforming files), then they can add the import tag to the
template.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/DatasetTemplate.update.html">DatasetTemplate.update</a></span><span class="op">(</span><span class="st">"id of your template"</span>, tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"import"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If users would like to make the template private (accessible only to
your user), then they can set the account_id parameter to None.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/DatasetTemplate.update.html">DatasetTemplate.update</a></span><span class="op">(</span><span class="st">"id of your template"</span>, account <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>If users would like to make the template accessible to all users on
EDP (including those outside of your organization) then they can set the
is_public parameter to True. As always, users should not share anything
sensitive outside of their organization.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/DatasetTemplate.update.html">DatasetTemplate.update</a></span><span class="op">(</span><span class="st">"id of your template"</span>, is_public <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-template">Create a Template<a class="anchor" aria-label="anchor" href="#create-a-template"></a>
</h2>
<p>To create a template, users should prepare the list of DatasetFields
with information about data types, expressions, entities, etc.</p>
<p>Example of list of fields:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    depends_on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"subject"</span><span class="op">)</span>,</span>
<span>    entity_type <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Sample ID from SUBJECT"</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>    ordering <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"record.subject"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"study"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"STUDY"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Study Code"</span>,</span>
<span>    ordering <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"None if value == 'UNASSIGNED' else value"</span>,</span>
<span>    data_type <span class="op">=</span> <span class="st">"string"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data_type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>    depends_on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hgvs_c"</span><span class="op">)</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"EDP variant entity, computed from the short variant CDS change"</span>,</span>
<span>    expression <span class="op">=</span> <span class="st">"entity_ids('variant', record.hgvs_c) if record.hgvs_c else None"</span>,</span>
<span>    is_transient <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"variant_cdna_grch38"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The following attributes should be added: - name - the name of the
field - data_type - the data type of the field - entity_type – the
entity type (only necessary for entity querying)</p>
<p>The following attributes are optional, but responsible for much of
the data transformation:</p>
<ul>
<li><p>expression - The expression that will be evaluated to populate
this field’s value. Put “value” to use the current value. Users can
refer to the Expressions documentation for more information. In order to
use data from another field (for comparison, splits, etc), users should
make sure that they also add it to the list of fields, which will allow
them to retrieve it using expression context variables:
record.name_of_field. Users should also add the field in the depends_on
parameter.</p></li>
<li><p>depends_on - This is a list of fields that the expression depends
on. Users can add any field names here. This will ensure that those
fields expressions are evaluated before its dependents. The template
creation will fail if there is a circular dependency.</p></li>
<li><p>is_transient - A transient field is a field that is not indexed
into the dataset, but calculated only while the template annotation is
running. This is useful for temporary fields/variables for complex
templates (default is False)</p></li>
</ul>
<p>The following attributes are optional, and informational only, but
encouraged:</p>
<ul>
<li>title - The field’s display name, shown in the UI and in CSV/Excel
exports.</li>
<li>description - Describes the contents of the field, shown in the
UI.</li>
<li>ordering - The order in which this column appears when retrieving
data from the dataset. Order is 0-based. Default is 0</li>
<li>is_hidden - Set to True if the field should be excluded by default
from the UI.</li>
</ul>
<p>After the list of the fields is prepared, other information about a
template can be added:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"My Variant Template"</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"1.2.0"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Import a special CSV file. Genome is assumed to be GRCh38, also has variant entity for GRCh37."</span>, template_type <span class="op">=</span> <span class="st">"dataset"</span>,</span>
<span>  is_public <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  entity_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"disable"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  fields <span class="op">=</span> <span class="va">fields</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The template_type should be set to “dataset”.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.create.html">DatasetTemplate.create</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"My Variant Template"</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"1.2.0"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Import a special CSV file. Genome is assumed to be GRCh38, also has variant entity for GRCh37."</span>, template_type <span class="op">=</span> <span class="st">"dataset"</span>,</span>
<span>  is_public <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fields <span class="op">=</span> <span class="va">fields</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Printing the template object will show the template’s ID and
contents.</p>
</div>
<div class="section level2">
<h2 id="create-a-dataset-with-a-template">Create a Dataset with a Template<a class="anchor" aria-label="anchor" href="#create-a-dataset-with-a-template"></a>
</h2>
<p>Users can create a dataset and set the structure with a template.</p>
<p>After that, users can create the template:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.retrieve.html">DatasetTemplate.retrieve</a></span><span class="op">(</span><span class="st">"id of your template"</span><span class="op">)</span></span>
<span><span class="co"># Specify where you want to create your new dataset</span></span>
<span><span class="va">vault</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Vault.get_personal_vault.html">Vault.get_personal_vault</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dataset_full_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">vault</span><span class="op">$</span><span class="va">full_path</span>, <span class="st">"my_fields_dataset"</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dataset will now have the non-transient fields from the template</span></span>
<span><span class="co"># with desired titles/descriptions and expressions, but no records</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.get_or_create_by_full_path.html">Dataset.get_or_create_by_full_path</a></span><span class="op">(</span><span class="va">dataset_full_path</span>, fields <span class="op">=</span> <span class="va">template</span><span class="op">$</span><span class="va">fields</span><span class="op">)</span></span></code></pre></div>
<p>Users can also create and a dataset and add the fields during file
import:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.retrieve.html">DatasetTemplate.retrieve</a></span><span class="op">(</span><span class="st">"id of your template"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify where you want to create your new dataset</span></span>
<span><span class="va">vault</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Vault.get_personal_vault.html">Vault.get_personal_vault</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dataset_full_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">vault</span><span class="op">$</span><span class="va">full_path</span>, <span class="st">"my_fields_dataset"</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.get_or_create_by_full_path.html">Dataset.get_or_create_by_full_path</a></span><span class="op">(</span><span class="va">dataset_full_path</span>, fields <span class="op">=</span> <span class="va">template</span><span class="op">$</span><span class="va">fields</span><span class="op">)</span></span>
<span><span class="va">file_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Object.retrieve.html">Object.retrieve</a></span><span class="op">(</span><span class="st">"id of file uploaded to EDP"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/DatasetImport.create.html">DatasetImport.create</a></span><span class="op">(</span></span>
<span>  dataset_id <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  object_id <span class="op">=</span> <span class="va">file_object</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  target_fields <span class="op">=</span> <span class="va">template</span><span class="op">$</span><span class="va">fields</span>,</span>
<span>  commit_mode <span class="op">=</span> <span class="st">"append"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wait for import to finish</span></span>
<span><span class="fu"><a href="../reference/Dataset.activity.html">Dataset.activity</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">id</span>, follow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="update-a-template">Update a Template:<a class="anchor" aria-label="anchor" href="#update-a-template"></a>
</h2>
<p>Template attributes such as the list of fields can be edited. For
example, new fields can be added to an existing template. In this
example, a new field called “phase_numeric” is added to the template to
transform roman numerals to numbers in the phase field of the
dataset.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quartzbio.github.io/quartzbio.edp/">quartzbio.edp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">jsonlite</a></span><span class="op">)</span></span>
<span><span class="co"># List all templates</span></span>
<span><span class="va">all_templates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.all.html">DatasetTemplate.all</a></span><span class="op">(</span>template_type <span class="op">=</span> <span class="st">"dataset"</span>, tags <span class="op">=</span> <span class="st">"import"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print ID &amp; name of each</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">all_templates</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">id</span>, <span class="va">all_templates</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve a template by ID</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.retrieve.html">DatasetTemplate.retrieve</a></span><span class="op">(</span><span class="st">"template_id"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Write to a JSON file for editing</span></span>
<span></span>
<span><span class="va">fields_json</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">template</span><span class="op">$</span><span class="va">fields</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">fields_json</span>, <span class="st">"template.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Edit the template.json file as needed</span></span>
<span><span class="co"># Add a field to file:</span></span>
<span><span class="co"># {</span></span>
<span><span class="co">#  "title": "phase_numeric",</span></span>
<span><span class="co">#  "name": "phase_numeric",</span></span>
<span><span class="co">#  "data_type": "string",</span></span>
<span><span class="co">#  "depends_on": ["phase"],</span></span>
<span><span class="co">#  "expression": "record.phase.replace('III', '3').replace('II', '2').replace('I', '1')"</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># Read the updated JSON file and convert it to a list</span></span>
<span><span class="va">updated_fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"template.json"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test the template by applying it to a few records</span></span>
<span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.get_by_full_path.html">Dataset.get_by_full_path</a></span><span class="op">(</span><span class="st">"vault:/my/dataset/"</span><span class="op">)</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.query.html">Dataset.query</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">id</span>, limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Annotator.annotate.html">Annotator.annotate</a></span><span class="op">(</span><span class="va">records</span>, <span class="va">updated_fields</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the template to the API</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.update.html">DatasetTemplate.update</a></span><span class="op">(</span><span class="va">template</span><span class="op">$</span><span class="va">id</span>, fields <span class="op">=</span> <span class="va">updated_fields</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply it to the existing dataset</span></span>
<span><span class="fu"><a href="../reference/DatasetMigration.create.html">DatasetMigration.create</a></span><span class="op">(</span></span>
<span>  source_id <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  target_id <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  target_fields <span class="op">=</span> <span class="va">template</span><span class="op">$</span><span class="va">fields</span>,</span>
<span>  commit_mode <span class="op">=</span> <span class="st">"upsert"</span>,</span>
<span>  source_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Follow the task, wait for it to complete</span></span>
<span><span class="fu"><a href="../reference/Dataset.activity.html">Dataset.activity</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">id</span>, follow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="building-and-testing-templates-with-the-annotator">Building and Testing Templates with the Annotator<a class="anchor" aria-label="anchor" href="#building-and-testing-templates-with-the-annotator"></a>
</h2>
<p>When creating new templates it it is useful to use the annotator to
test and validate the fields and their expressions. The below snippet
will use the annotator to process records in real time with the template
fields.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://quartzbio.github.io/quartzbio.edp/">quartzbio.edp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get records from dataset</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.get_or_create_by_full_path.html">Dataset.get_or_create_by_full_path</a></span><span class="op">(</span><span class="va">dataset_full_path</span><span class="op">)</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu">dataset.query</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load files from a template</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetTemplate.retrieve.html">DatasetTemplate.retrieve</a></span><span class="op">(</span><span class="va">template_id</span><span class="op">)</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="va">template</span><span class="op">$</span><span class="fu">fieldsAnnotator.annotate</span><span class="op">(</span>records <span class="op">=</span> <span class="va">records</span>, fields <span class="op">=</span> <span class="va">fields</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="api-endpoints">API Endpoints<a class="anchor" aria-label="anchor" href="#api-endpoints"></a>
</h2>
<p>Methods do not accept URL parameters or request bodies unless
specified. Please note that if your EDP endpoint is
sponsor.edp.aws.quartz.bio, you would use
sponsor.api.edp.aws.quartz.bio.</p>
<div class="section level3">
<h3 id="dataset-templates">Dataset Templates<a class="anchor" aria-label="anchor" href="#dataset-templates"></a>
</h3>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">create</td>
<td align="center">POST <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_templates</edp_api_host>
</td>
<td align="center">Create a dataset template.</td>
<td align="center">This request requires an authorized user with
appropriate permissions.</td>
<td align="center">The response contains the new DatasetTemplate
resource.</td>
</tr></tbody>
</table>
<p>Request Body: In the request body, provide an object with the
following properties:</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="24%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">name</td>
<td align="center">string</td>
<td align="center">A short name for the new template.</td>
</tr>
<tr class="even">
<td align="center">description</td>
<td align="center">string</td>
<td align="center">A description for the template.</td>
</tr>
<tr class="odd">
<td align="center">fields</td>
<td align="center">objects</td>
<td align="center">A list of <a href="creating_and_migrating_datasets.html">valid dataset
fields.</a>
</td>
</tr>
<tr class="even">
<td align="center">version</td>
<td align="center">string</td>
<td align="center">A string representing a template version (no
spaces).</td>
</tr>
<tr class="odd">
<td align="center">template_type</td>
<td align="center">string</td>
<td align="center">The type of template: dataset, recipe or search.</td>
</tr>
<tr class="even">
<td align="center">is_public</td>
<td align="center">boolean</td>
<td align="center">True if visible to anyone in a user’s organization
(default False).</td>
</tr>
<tr class="odd">
<td align="center">annotator_params</td>
<td align="center">object</td>
<td align="center">(optional) Configuration parameters for the
Annotator.</td>
</tr>
<tr class="even">
<td align="center">entity_params</td>
<td align="center">object</td>
<td align="center">(optional) Configuration parameters for entity
detection.</td>
</tr>
<tr class="odd">
<td align="center">reader_params</td>
<td align="center">object</td>
<td align="center">(optional) Configuration parameters for readers.</td>
</tr>
<tr class="even">
<td align="center">validation_params</td>
<td align="center">object</td>
<td align="center">(optional) Configuration parameters for
validation.</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">delete</td>
<td align="center">DELETE <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_templates/{ID}</edp_api_host>
</td>
<td align="center">Delete a dataset template.</td>
<td align="center">This request requires an authorized user with write
permissions on the resource.</td>
<td align="center">The response returns “HTTP 200 OK” when
successful.</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">generate</td>
<td align="center">GET <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/datasets/{DATASET_ID}/template</edp_api_host>
</td>
<td align="center">Create a dataset template from an existing
dataset.</td>
<td align="center">This request requires an authorized user with
permission.</td>
<td align="center">The response contains an unsaved DatasetTemplate
object for the specified dataset.</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">get</td>
<td align="center">GET <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_templates/{ID}</edp_api_host>
</td>
<td align="center">Retrieve a dataset template.</td>
<td align="center">This request requires an authorized user with
permission.</td>
<td align="center">The response contains a DatasetTemplate
resource.</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">list</td>
<td align="center">GET <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_templates</edp_api_host>
</td>
<td align="center">Retrieve a list of available dataset templates.</td>
<td align="center">This request requires an authorized user with read
permission.</td>
<td align="center">The response contains a list of resources visible to
the requesting user.</td>
</tr></tbody>
</table>
<p>Parameters This request accepts the following parameters:</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="13%">
<col width="72%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">limit</td>
<td align="center">integer</td>
<td align="center">The number of objects to return per page.</td>
</tr>
<tr class="even">
<td align="center">offset</td>
<td align="center">integer</td>
<td align="center">The offset within the list of available objects.</td>
</tr>
</tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Caplan, Karl Forner, QuartzBio.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last modified: 15-Apr-2025 Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
