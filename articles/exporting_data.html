<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exporting Data via API • quartzbio.edp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exporting Data via API">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">quartzbio.edp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/r_authentication.html">Autentication</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/quartzbio/quartzbio.edp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Exporting Data via API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quartzbio/quartzbio.edp/blob/main/vignettes/exporting_data.Rmd" class="external-link"><code>vignettes/exporting_data.Rmd</code></a></small>
      <div class="d-none name"><code>exporting_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The EDP provides several data accessibility and portability tools to
facilitate the export of data to downstream tools for molecular
analysis.</p>
<p>Datasets can be exported in multiple formats:</p>
<ul>
<li>JSON: JSON Lines format (gzipped).</li>
<li>CSV: Comma Separated Value format (flattened, gzipped).</li>
<li>TSV: Tab Separated Value format (flattened, gzipped).</li>
<li>Excel (XLSX): Microsoft Excel format (flattened).</li>
</ul>
<p>Exporting data can take anywhere from a few seconds to tens of
minutes, depending on the number of records and selected format. Exports
are processed server-side, and the output is a downloadable file. An
exported JSON file can be re-imported into EDP without any
modification.</p>
</div>
<div class="section level2">
<h2 id="export-limits">Export Limits<a class="anchor" aria-label="anchor" href="#export-limits"></a>
</h2>
<p>Different export formats have different limits:</p>
<table class="table">
<thead><tr class="header">
<th>Format</th>
<th>Max Records</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Excel</td>
<td>1,048,576 records</td>
</tr>
<tr class="even">
<td>JSON</td>
<td>500,000,000 records</td>
</tr>
<tr class="odd">
<td>TSV</td>
<td>500,000,000 records</td>
</tr>
<tr class="even">
<td>CSV</td>
<td>500,000,000 records</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="flattened-fields-csvxlsx">Flattened Fields (CSV/XLSX)<a class="anchor" aria-label="anchor" href="#flattened-fields-csvxlsx"></a>
</h2>
<p>CSV and XLSX exports are processed by a flattening algorithm during
export. The reason for this is to handle list fields, which are not well
supported by Excel and other CSV readers. The following example
illustrates the effects of the flattening algorithm:</p>
<p>The following dataset records:</p>
<pre><code>{"a": "a", "b": ["x"]}
{"a": "a", "b": ["x", "y"]}
{"a": "a", "b": ["x", "y", "z"]}</code></pre>
<p>will be exported to the following CSV:</p>
<pre><code>a,b.0,b.1,b.2
a,x,,
a,x,y,
a,x,y,z</code></pre>
</div>
<div class="section level2">
<h2 id="export-a-dataset">Export a Dataset<a class="anchor" aria-label="anchor" href="#export-a-dataset"></a>
</h2>
<p>To export a dataset, users can retrieve it by name or ID and initiate
the export. Exports can take a few minutes for large datasets. Users can
always start a large export and check back when it finishes on the
Activity tab of the EDP web interface. Exports can also be saved
directly into a vault (with target_full_path keyword argument) and
accessed from there.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quartzbio.github.io/quartzbio.edp/">quartzbio.edp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.get_or_create_by_full_path.html">Dataset.get_or_create_by_full_path</a></span><span class="op">(</span><span class="st">"quartzbio:Public:/HGNC/3.3.1-2021-08-25/HGNC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export the entire dataset (~40k records), this may take a minute...</span></span>
<span><span class="co"># NOTE: `format` can be: json, tsv, csv, or excel</span></span>
<span><span class="va">export</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetExport.create.html">DatasetExport.create</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"csv"</span>,</span>
<span>  params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  send_email_on_completion <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wait for the export to complete</span></span>
<span><span class="fu"><a href="../reference/Dataset.activity.html">Dataset.activity</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetExport.get_download_url.html">DatasetExport.get_download_url</a></span><span class="op">(</span><span class="va">export</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"data.csv.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># An exports can also be saved to a path in a vault</span></span>
<span><span class="va">export</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetExport.create.html">DatasetExport.create</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"csv"</span>,</span>
<span>  params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  send_email_on_completion <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  target_full_path <span class="op">=</span> <span class="st">"my_vault:/path/to/csv_files_folder/my_export"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exporting-large-amounts-of-data">Exporting Large Amounts of Data<a class="anchor" aria-label="anchor" href="#exporting-large-amounts-of-data"></a>
</h2>
<p>An example file size for a CSV file with 150M rows and 50 columns
populated with floats and relatively short strings is about 50GB. In
general, users are recommended not to work with files this size directly
and instead to shrink the export by applying filters or selecting only
specific columns. If necessary, users can also export in batches
(e.g. export by chromosome or sample).</p>
<div class="section level3">
<h3 id="export-a-filtered-dataset">Export a Filtered Dataset<a class="anchor" aria-label="anchor" href="#export-a-filtered-dataset"></a>
</h3>
<p>Users can leverage the dataset filtering system to export a slice of
a dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quartzbio.github.io/quartzbio.edp/">quartzbio.edp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.get_by_full_path.html">Dataset.get_by_full_path</a></span><span class="op">(</span><span class="st">"quartzbio:Public:/ClinVar/5.2.0-20221105/Variants-GRCH37"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter the dataset by field values and limit the number of results</span></span>
<span><span class="co"># NOTE: `format` can be: json, tsv, csv, or excel</span></span>
<span><span class="va">filters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"info.ORIGIN__gte"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"variant"</span>, <span class="st">"info.ORIGIN"</span>, <span class="st">"gene"</span><span class="op">)</span></span>
<span><span class="va">export</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetExport.create.html">DatasetExport.create</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"json"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>filters <span class="op">=</span> <span class="va">filters</span>, fields <span class="op">=</span> <span class="va">fields</span>, limit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  follow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download to your home directory</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DatasetExport.get_download_url.html">DatasetExport.get_download_url</a></span><span class="op">(</span><span class="va">export</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"my_variants.json.gz"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="api-endpoints">API Endpoints<a class="anchor" aria-label="anchor" href="#api-endpoints"></a>
</h2>
<p>Methods do not accept URL parameters or request bodies unless
specified. Please note that if your EDP endpoint is
sponsor.edp.aws.quartz.bio, you would use
sponsor.api.edp.aws.quartz.bio.</p>
<div class="section level3">
<h3 id="dataset-exports">Dataset Exports<a class="anchor" aria-label="anchor" href="#dataset-exports"></a>
</h3>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">create</td>
<td align="center">POST <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_exports</edp_api_host>
</td>
<td align="center">Create a dataset export for a dataset.</td>
<td align="center">This request requires an authorized user with read
permission for the dataset.</td>
<td align="center">The response contains a single DatasetExport
resource.</td>
</tr></tbody>
</table>
<p>Request Body:</p>
<p>In the request body, provide an object with the following
properties:</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="23%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">dataset_id</td>
<td align="center">integer</td>
<td align="center">A valid dataset ID.</td>
</tr>
<tr class="even">
<td align="center">format</td>
<td align="center">string</td>
<td align="center">The export file format.</td>
</tr>
<tr class="odd">
<td align="center">params</td>
<td align="center">object</td>
<td align="center">Dataset query parameters.</td>
</tr>
<tr class="even">
<td align="center">target_full_path</td>
<td align="center">string</td>
<td align="center">(Optional) A vault location to store the export
output (must be an EDP full path).</td>
</tr>
<tr class="odd">
<td align="center">priority</td>
<td align="center">integer</td>
<td align="center">(Optional) A priority to assign to this task.</td>
</tr>
<tr class="even">
<td align="center">send_email_on_completion</td>
<td align="center">boolean</td>
<td align="center">(Optional) An email is sent when the export is ready
(default: false)</td>
</tr>
</tbody>
</table>
<p>The following export formats (format property) are available:</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="23%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="center">Format</th>
<th align="center">Extension</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">json</td>
<td align="center">.json.gz</td>
<td align="center">JSONL format, gzipped.</td>
</tr>
<tr class="even">
<td align="center">csv</td>
<td align="center">.csv</td>
<td align="center">Comma-separated format</td>
</tr>
<tr class="odd">
<td align="center">csv-expand</td>
<td align="center">.csv</td>
<td align="center">Comma-separated format, with expanded list
values.</td>
</tr>
<tr class="even">
<td align="center">excel</td>
<td align="center">.xlsx</td>
<td align="center">Excel (XLSX) format.</td>
</tr>
<tr class="odd">
<td align="center">excel-expand</td>
<td align="center">.xlsx</td>
<td align="center">Excel (XLSX) format, with list values expanded.</td>
</tr>
</tbody>
</table>
<p>When using an “expanded” mode, fields containing list values
(multiple distinct values) will be expanded into independent columns in
the output. This is useful in some downstream applications that do not
natively support list within columns.</p>
<p>The following query parameters (params property) are supported for
exports:</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="19%">
<col width="61%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">limit</td>
<td align="center">integer</td>
<td align="center">The number of records to export (between 1 and
1,000,000).</td>
</tr>
<tr class="even">
<td align="center">filters</td>
<td align="center">objects</td>
<td align="center">A valid filter object.</td>
</tr>
<tr class="odd">
<td align="center">fields</td>
<td align="center">string</td>
<td align="center">A list of fields to include in the results.</td>
</tr>
<tr class="even">
<td align="center">exclude_fields</td>
<td align="center">string</td>
<td align="center">A list of fields to exclude in the results.</td>
</tr>
<tr class="odd">
<td align="center">query</td>
<td align="center">string</td>
<td align="center">A valid query string.</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">delete</td>
<td align="center">DELETE <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_exports/{ID}</edp_api_host>
</td>
<td align="center">Delete a dataset export.</td>
<td align="center">This request requires an authorized user with write
permissions on the dataset.</td>
<td align="center">The response returns “HTTP 200 OK” when
successful.</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">download</td>
<td align="center">GET <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_exports/{ID}/download</edp_api_host>
</td>
<td align="center">Download a dataset export.</td>
<td align="center">This request requires an authorized user with read
permissions on the dataset.</td>
<td align="center">The default response is a 302 redirect. When redirect
mode is disabled, the response contains a URL to the file.</td>
</tr></tbody>
</table>
<p>Parameters</p>
<p>This request accepts the following parameter:</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="22%">
<col width="54%">
</colgroup>
<thead><tr class="header">
<th align="center">Property</th>
<th align="center">Value</th>
<th align="center">Description</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">redirect</td>
<td align="center">boolean</td>
<td align="center">Return a 302 redirect to the download location
(default: true).</td>
</tr></tbody>
</table>
<p>Dataset exports may expire after 24 hours, after which the download
URL will not work. Please re-run the export if necessary.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">get</td>
<td align="center">GET <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/dataset_exports/{ID}</edp_api_host>
</td>
<td align="center">Retrieve metadata about an export.</td>
<td align="center">This request requires an authorized user with read
permissions on the dataset.</td>
<td align="center">The response contains a DatasetExport resource.</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">list</td>
<td align="center">GET <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/datasets/{DATASET_ID}/exports</edp_api_host>
</td>
<td align="center">List the exports associated with a dataset.</td>
<td align="center">This request requires an authorized user with read
permissions on the dataset.</td>
<td align="center">The response contains a list of DatasetExport
resources.</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">HTTP Request</th>
<th align="center">Description</th>
<th align="center">Authorization</th>
<th align="center">Response</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">cancel</td>
<td align="center">PUT <a href="https://" class="external-link uri">https://</a><edp_api_host>/v2/datasets_exports/{ID}/cancel</edp_api_host>
</td>
<td align="center">List the exports associated with a dataset.</td>
<td align="center">This request requires an authorized user with read
permissions on the dataset.</td>
<td align="center">The response will contain a DatasetExport resource
with the status canceled.</td>
</tr></tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Caplan, Karl Forner, QuartzBio.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last updated: 11th March 2025 Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
